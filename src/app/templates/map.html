<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispatch Database - Bézier Roads Map</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🚛</text></svg>">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #map {
            height: 100vh;
            width: 100%;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        /* Custom map control styling */
        .leaflet-control-zoom {
            background-color: rgba(60, 60, 60, 0.9) !important;
            border: none !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6) !important;
            backdrop-filter: blur(10px) !important;
        }

        .leaflet-control-zoom a {
            background-color: rgba(60, 60, 60, 0.9) !important;
            color: #bdc3c7 !important;
            border: none !important;
            font-weight: 600 !important;
            font-size: 18px !important;
        }

        .leaflet-control-zoom a:hover {
            background-color: rgba(80, 80, 80, 0.9) !important;
            color: white !important;
        }

        .leaflet-control-layers {
            background-color: rgba(60, 60, 60, 0.9) !important;
            border: none !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6) !important;
            backdrop-filter: blur(10px) !important;
            color: #bdc3c7 !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-size: 12px !important;
            padding: 8px !important;
            min-width: 120px !important;
            text-align: center !important;
        }

        .leaflet-control-layers-toggle {
            background-color: rgba(60, 60, 60, 0.9) !important;
            border: none !important;
            border-radius: 4px !important;
            width: 36px !important;
            height: 36px !important;
            background-image: none !important;
            position: relative !important;
        }

        .leaflet-control-layers-toggle::before {
            content: "⚙" !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            color: #bdc3c7 !important;
            font-size: 16px !important;
            font-weight: bold !important;
        }

        .leaflet-control-layers-toggle:hover::before {
            color: white !important;
        }

        .leaflet-control-layers-expanded {
            background-color: rgba(60, 60, 60, 0.9) !important;
            border: none !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6) !important;
            backdrop-filter: blur(10px) !important;
            color: #bdc3c7 !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            font-size: 12px !important;
            padding: 12px !important;
            min-width: 200px !important;
        }

        .leaflet-control-layers label {
            color: #bdc3c7 !important;
            font-size: 12px !important;
            font-weight: 500 !important;
            margin: 4px 0 !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            padding: 4px 8px !important;
            border-radius: 4px !important;
            transition: all 0.2s ease !important;
        }

        .leaflet-control-layers label:hover {
            background-color: rgba(80, 80, 80, 0.5) !important;
            color: white !important;
        }

        .leaflet-control-layers input[type="radio"] {
            margin-right: 8px !important;
            accent-color: #e74c3c !important;
        }

        /* Tooltip styling */
        .leaflet-popup-content-wrapper {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            padding: 0 !important;
        }

        .leaflet-popup-tip {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
        }

        .leaflet-popup {
            margin-bottom: 0 !important;
        }

        /* Marker z-index */
        .leaflet-marker-icon {
            z-index: 1000 !important;
        }

        .leaflet-popup {
            z-index: 1001 !important;
        }
    </style>
</head>

<body>
    <div id="loading" class="loading">
        <h3>Loading Dispatch Database Map...</h3>
        <p>Fetching roads and locations...</p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize the map - centered on Queensland mining region
        const map = L.map('map').setView([-23.847083, 148.980202], 11);

        // Satellite Streets (Default)
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v12/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Satellite Streets',
            overlay: false,
            control: true
        }).addTo(map);

        // Topographic
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/outdoors-v12/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Topographic',
            overlay: false,
            control: true
        });

        // Streets
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/streets-v12/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Streets',
            overlay: false,
            control: true
        });

        // Satellite
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/satellite-v12/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Satellite',
            overlay: false,
            control: true
        });

        // Standard
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/standard-v12/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Standard',
            overlay: false,
            control: true
        });

        // Dark
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v12/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Dark',
            overlay: false,
            control: true
        });

        // Topographic Dark
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/navigation-night-v2/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Topographic Dark',
            overlay: false,
            control: true
        });

        // Streets Dark
        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v12/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY291cHN0ZXI3NCIsImEiOiJja2xwdjRwaWYwc2Q2Mm9sYmprbzhueng2In0.p-FbkbBhJWBKW-evWZfmgw', {
            attribution: 'Mapbox',
            name: 'Streets Dark',
            overlay: false,
            control: true
        });

        L.control.layers().addTo(map);

        // Add right-click bearing control
        let isRightClicking = false;
        let startX, startY;

        map.getContainer().addEventListener('contextmenu', function (e) {
            e.preventDefault();
            isRightClicking = true;
            startX = e.clientX;
            startY = e.clientY;

            // Add visual feedback
            document.body.style.cursor = 'grabbing';
        });

        map.getContainer().addEventListener('mousemove', function (e) {
            if (isRightClicking) {
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;

                // Convert mouse movement to bearing change
                const bearingChange = deltaX * 0.5; // Adjust sensitivity
                const pitchChange = deltaY * 0.1; // Adjust sensitivity

                // Update map bearing (rotation)
                const currentBearing = map.getBearing ? map.getBearing() : 0;
                const newBearing = (currentBearing + bearingChange) % 360;

                if (map.setBearing) {
                    map.setBearing(newBearing);
                }

                // Update map pitch (tilt) if supported
                if (map.setPitch) {
                    const currentPitch = map.getPitch ? map.getPitch() : 0;
                    const newPitch = Math.max(0, Math.min(60, currentPitch + pitchChange));
                    map.setPitch(newPitch);
                }

                startX = e.clientX;
                startY = e.clientY;
            }
        });

        map.getContainer().addEventListener('mouseup', function (e) {
            if (isRightClicking) {
                isRightClicking = false;
                document.body.style.cursor = '';
            }
        });

        // Add bearing reset on double-click
        map.getContainer().addEventListener('dblclick', function (e) {
            e.preventDefault();
            if (map.setBearing) {
                map.setBearing(0);
            }
            if (map.setPitch) {
                map.setPitch(0);
            }
        });

        let infrastructureCount = 0;
        let vehicleCount = 0;
        let segmentCount = 0;
        let openSegmentCount = 0;
        let closedSegmentCount = 0;
        let unitTypes = {};

        // Load locations
        fetch('/api/locations')
            .then(response => response.json())
            .then(locations => {
                // Separate infrastructure and vehicles
                const infrastructure = locations.filter(loc => loc.location_category === 'infrastructure');
                const vehicles = locations.filter(loc => loc.location_category === 'vehicle');

                infrastructureCount = infrastructure.length;
                vehicleCount = vehicles.length;

                // Count unit types
                locations.forEach(loc => {
                    const unitType = loc.unit_type || 'Unknown';
                    unitTypes[unitType] = (unitTypes[unitType] || 0) + 1;
                });

                // Add infrastructure markers (larger)
                infrastructure.forEach(location => {
                    
                    const color = '#FF6B6B';
                    const unitName = location.unit_type || location.location_name || 'Unknown';

                    const elegantPopup = `
                        <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                                    background: rgba(255, 255, 255, 0.95); border-radius: 8px; padding: 0; 
                                    min-width: 200px;">
                            <div style="background: linear-gradient(135deg, ${color} 0%, ${color}dd 100%); 
                                        color: white; padding: 12px 16px; border-radius: 8px 8px 0 0; 
                                        font-weight: 600; font-size: 14px; text-align: center;">
                                ${unitName}
                            </div>
                            <div style="padding: 12px 16px; color: #333;">
                                <div style="margin-bottom: 8px; font-size: 12px; color: #666;">
                                    <strong>ID:</strong> ${location.location_id}
                                </div>
                                <div style="margin-bottom: 6px; font-size: 12px; color: #666;">
                                    <strong>Lat:</strong> ${location.latitude.toFixed(6)}
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    <strong>Lon:</strong> ${location.longitude.toFixed(6)}
                                </div>
                            </div>
                        </div>
                    `;

                    L.circleMarker([location.latitude, location.longitude], {
                        radius: 6,
                        popup: elegantPopup,
                        color: 'white',
                        weight: 2,
                        fillColor: color,
                        fillOpacity: 0.8
                    }).addTo(map);
                });

                // Add vehicle markers (smaller)
                vehicles.forEach(location => {
                    
                    const color = '#4ECDC4';
                    const unitName = location.unit_type || location.location_name || 'Unknown';

                    const elegantPopup = `
                        <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                                    background: rgba(255, 255, 255, 0.95); border-radius: 8px; padding: 0; 
                                    min-width: 200px;">
                            <div style="background: linear-gradient(135deg, ${color} 0%, ${color}dd 100%); 
                                        color: white; padding: 12px 16px; border-radius: 8px 8px 0 0; 
                                        font-weight: 600; font-size: 14px; text-align: center;">
                                ${unitName}
                            </div>
                            <div style="padding: 12px 16px; color: #333;">
                                <div style="margin-bottom: 8px; font-size: 12px; color: #666;">
                                    <strong>ID:</strong> ${location.location_id}
                                </div>
                                <div style="margin-bottom: 6px; font-size: 12px; color: #666;">
                                    <strong>Lat:</strong> ${location.latitude.toFixed(6)}
                                </div>
                                <div style="font-size: 12px; color: #666;">
                                    <strong>Lon:</strong> ${location.longitude.toFixed(6)}
                                </div>
                            </div>
                        </div>
                    `;

                    L.circleMarker([location.latitude, location.longitude], {
                        radius: 6,
                        popup: elegantPopup,
                        color: 'white',
                        weight: 2,
                        fillColor: color,
                        fillOpacity: 0.8
                    }).addTo(map);
                });
            })
            .catch(error => {
                console.error('Error loading locations:', error);
            });

        // Load lane segments
        fetch('/api/segments')
            .then(response => response.json())
            .then(segmentsGeoJSON => {
                segmentCount = segmentsGeoJSON.features.length;

                // Add segments to map
                L.geoJSON(segmentsGeoJSON, {
                    style: function (feature) {
                        const isClosed = feature.properties.is_closed;
                        const direction = feature.properties.direction;

                        let color, weight, opacity;
                        if (isClosed) {
                            color = '#DC143C';  // Red for closed
                            weight = 3;
                            opacity = 0.7;
                            closedSegmentCount++;
                        } else {
                            if (direction === 'forward') {
                                color = '#2E8B57';  // Green for forward
                            } else {
                                color = '#4169E1';  // Blue for reverse
                            }
                            weight = 4;
                            opacity = 0.8;
                            openSegmentCount++;
                        }

                        return {
                            color: color,
                            weight: weight,
                            opacity: opacity,
                            smoothFactor: 1.0
                        };
                    },
                    onEachFeature: function (feature, layer) {
                        const props = feature.properties;
                        const isClosed = props.is_closed;
                        const statusColor = isClosed ? '#e74c3c' : '#27ae60';
                        const statusText = isClosed ? 'CLOSED' : 'OPEN';

                        const elegantSegmentPopup = `
                            <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                                        background: rgba(255, 255, 255, 0.95); border-radius: 8px; padding: 0; 
                                        min-width: 240px;">
                                <div style="background: linear-gradient(135deg, ${feature.properties.is_closed ? '#DC143C' : (feature.properties.direction === 'forward' ? '#2E8B57' : '#4169E1')} 0%, ${feature.properties.is_closed ? '#DC143C' : (feature.properties.direction === 'forward' ? '#2E8B57' : '#4169E1')}dd 100%); 
                                            color: white; padding: 12px 16px; border-radius: 8px 8px 0 0; 
                                            font-weight: 600; font-size: 14px; text-align: center;">
                                    Road ${props.road_id} - Segment ${props.lane_id.split('_')[2] || '0'}
                                </div>
                                <div style="padding: 12px 16px; color: #333;">
                                    <div style="margin-bottom: 8px; font-size: 12px; color: #666;">
                                        <strong>Direction:</strong> ${props.direction ? props.direction.charAt(0).toUpperCase() + props.direction.slice(1) : 'Unknown'}
                                    </div>
                                    <div style="margin-bottom: 8px; font-size: 12px; color: #666;">
                                        <strong>Status:</strong> <span style="color: ${statusColor}; font-weight: 600;">${statusText}</span>
                                    </div>
                                    <div style="font-size: 12px; color: #666;">
                                        <strong>Length:</strong> ${props.length_m ? props.length_m.toFixed(1) : '0.0'}m
                                    </div>
                                </div>
                            </div>
                        `;

                        layer.bindPopup(elegantSegmentPopup);
                    }
                }).addTo(map);

                // Hide loading indicator and add legend
                document.getElementById('loading').style.display = 'none';
                addAdvancedLegend();
            })
            .catch(error => {
                console.error('Error loading segments:', error);
                document.getElementById('loading').innerHTML = '<h3>Error loading map data</h3><p>' + error + '</p>';
            });

        function addAdvancedLegend() {
            const legendHtml = `
                <div id="legend-panel" style="position: fixed; 
                            top: 20px; right: 20px; width: 340px; 
                            background-color: rgba(60, 60, 60, 0.9); border: none; z-index:9999; 
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.6);
                            transition: all 0.3s ease; backdrop-filter: blur(10px);
                            resize: both; overflow: auto; min-width: 300px; min-height: 200px;">
                    
                    <div id="legend-header" style="background-color: rgba(40, 40, 40, 0.9); padding: 12px 16px; 
                                border-radius: 8px 8px 0 0; cursor: pointer; 
                                display: flex; justify-content: space-between; align-items: center;"
                         onclick="toggleLegend()">
                        <div style="display: flex; align-items: center;">
                            <div style="width: 20px; height: 20px; background-color: #e74c3c; border-radius: 4px; 
                                        margin-right: 10px; display: flex; align-items: center; justify-content: center;">
                                <span style="color: white; font-size: 12px; font-weight: bold;">🔗</span>
                            </div>
                            <span style="color: white; font-weight: 600; font-size: 14px;">Mine Map</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <div style="width: 24px; height: 24px; background-color: rgba(80, 80, 80, 0.8); 
                                        border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                                <span style="color: #bdc3c7; font-size: 12px;">⚙</span>
                            </div>
                            <div style="color: #bdc3c7; font-size: 18px; transition: transform 0.3s ease;" id="legend-chevron">▼</div>
                        </div>
                    </div>
                    
                    <div id="legend-content" style="padding: 0; color: white; font-size: 12px; max-height: 400px; overflow-y: auto;">
                        <div style="border-left: 3px solid #e74c3c; margin: 8px 0;">
                            <div style="background-color: rgba(231, 76, 60, 0.1); padding: 8px 12px; cursor: pointer; 
                                        display: flex; align-items: center; justify-content: space-between;"
                                 onclick="toggleGroup('segment-group')">
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 16px; height: 16px; background-color: #e74c3c; border-radius: 3px; 
                                                margin-right: 8px; display: flex; align-items: center; justify-content: center;">
                                        <span style="color: white; font-size: 10px;">🔗</span>
                                    </div>
                                    <span style="color: #e74c3c; font-weight: 600; font-size: 13px;">Segment Layers</span>
                                    <div style="background-color: #e74c3c; color: white; border-radius: 10px; 
                                                padding: 2px 8px; margin-left: 8px; font-size: 10px;">2</div>
                                </div>
                                <div style="color: #e74c3c; font-size: 14px; transition: transform 0.3s ease;" id="segment-group-chevron">▼</div>
                            </div>
                            <div id="segment-group-content" style="padding: 8px 12px 8px 32px;">
                                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                                    <div style="width: 12px; height: 3px; background-color: #2E8B57; margin-right: 10px; border-radius: 2px;"></div>
                                    <span style="color: #bdc3c7;">Open Segments (${openSegmentCount})</span>
                                </div>
                                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                                    <div style="width: 12px; height: 3px; background-color: #DC143C; margin-right: 10px; border-radius: 2px;"></div>
                                    <span style="color: #bdc3c7;">Closed Segments (${closedSegmentCount})</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="border-left: 3px solid #3498db; margin: 8px 0;">
                            <div style="background-color: rgba(52, 152, 219, 0.1); padding: 8px 12px; cursor: pointer; 
                                        display: flex; align-items: center; justify-content: space-between;"
                                 onclick="toggleGroup('unit-group')">
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 16px; height: 16px; background-color: #3498db; border-radius: 3px; 
                                                margin-right: 8px; display: flex; align-items: center; justify-content: center;">
                                        <span style="color: white; font-size: 10px;">📍</span>
                                    </div>
                                    <span style="color: #3498db; font-weight: 600; font-size: 13px;">Location Types</span>
                                    <div style="background-color: #3498db; color: white; border-radius: 10px; 
                                                padding: 2px 8px; margin-left: 8px; font-size: 10px;">${Object.keys(unitTypes).length}</div>
                                </div>
                                <div style="color: #3498db; font-size: 14px; transition: transform 0.3s ease;" id="unit-group-chevron">▼</div>
                            </div>
                            <div id="unit-group-content" style="padding: 8px 12px 8px 32px;">
                                ${Object.entries(unitTypes).sort((a, b) => b[1] - a[1]).map(([unitType, count]) => `
                                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                                    <div style="width: 8px; height: 8px; background-color: ${unitType === 'Unknown' ? '#808080' : '#FF6B6B'}; margin-right: 10px; border-radius: 50%;"></div>
                                    <span style="color: #bdc3c7;">${unitType} (${count})</span>
                                </div>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', legendHtml);

            // Add legend functionality after DOM insertion
            setupLegendFunctionality();
        }

        function setupLegendFunctionality() {
            // Make legend draggable
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            const legendPanel = document.getElementById('legend-panel');
            if (!legendPanel) return;

            legendPanel.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            function dragStart(e) {
                if (e.target.closest('#legend-header')) {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;

                    if (e.target === legendPanel || e.target.closest('#legend-header')) {
                        isDragging = true;
                    }
                }
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;

                    xOffset = currentX;
                    yOffset = currentY;

                    legendPanel.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
            }
        }

        function toggleLegend() {
            const content = document.getElementById('legend-content');
            const chevron = document.getElementById('legend-chevron');

            if (content && chevron) {
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    chevron.style.transform = 'rotate(0deg)';
                } else {
                    content.style.display = 'none';
                    chevron.style.transform = 'rotate(-90deg)';
                }
            }
        }

        function toggleGroup(groupId) {
            const content = document.getElementById(groupId + '-content');
            const chevron = document.getElementById(groupId + '-chevron');

            if (content && chevron) {
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    chevron.style.transform = 'rotate(0deg)';
                } else {
                    content.style.display = 'none';
                    chevron.style.transform = 'rotate(-90deg)';
                }
            }
        }
    </script>
</body>

</html>